---
title: 区块链技术思考
date: 2017-07-13 17:05:37
tags: 区块链，分布式
---

很长时间没有写作，博客快要荒废了（虽然本来就没几篇文章）。。

这段时间研究了很多技术，涉及面非常广，包含深度学习，量子计算，分布式系统等等。有的了解了基本原理就放弃了，有的稍微深入一点。区块链技术属于前者。

区块链技术其实是一种分布式系统。其最根本的问题还是解决一致性问题，整个区块链不能分裂。这跟一般分布式系统是一样的。一般的分布式系统使用 paxo 或 raft 来保证同一时间只能有一个master（leader），所有多系统的更改都由master 发起，从而保证整个系统的一致性。

区块链也需要一个leader节点，但开放网络环境下节点实在太多了，大家都争这个leader权限是要打仗的，而且不知道要打多少轮才能决出胜者。为了解决这个问题，区块链引进了一个核心概念：工作量证明。简单的说就是谁NB谁当leader，光打嘴炮可不行，你得证明你NB。如何证明呢？算个hash吧。

假如有一系列交易数据A B C,为了保证这些交易不被篡改，我们可以算一个hash

```
h0 = hash(A)
h1 ＝ hash(B+h0)
h2 = hash(C+h2)
...

```

这样就形成了一个链式结构，在这个链上任何一条数据做了修改，哪么整个链最后的hash都会发生变化，这一点确保其不可被修改。

只是不被篡改，这个事情还没完，因为我们的问题还没有解答，如何选出leader？

如果我们对h0,h1,h2 增加一点要求，要求其只能以 n个0开头，公式也做一点变化
```
h0=  hash(A|| Nonce0) 
h1 = hash(B || h0 || Nonce1)
h2 = hash(C || h1 || Nonce2)

```

那么这个难度就增加了，而且通过h 来推导Nonce几乎是不可能的。所以只能通过硬算，不断尝试，去凑。这样谁运算的速度快 ＋ 一点运气，谁就能当leader。leader的作用就是记帐，所以争夺leader就是争夺记帐权。而比特币，或其他虚拟货币为了让这个机制work下去，会给leader一定的奖励，所以就有了挖矿这回事。挖矿就是去争做leader，争着记帐。

因为要保证公平，所以这个leader是一次性的，比特币会调整难度值（就是要求计算出来的hash 由几个0开头）来保证始终差不多10分钟产生一个新的区块。这也就是一个交易要等10分钟才能被commit到区块链中的原因。


基本原理到这里。

区块链技术的优点所有人都知道。但任何技术都不是万能的，区块链也一样。区块链的工作量证明机制就是其最大的缺陷。为了确定一个记帐权限，需要大量的计算，而且计算量还会不断增加。其实这些计算量是没有任何意义的，不产生任何价值，也就是完全的浪费。